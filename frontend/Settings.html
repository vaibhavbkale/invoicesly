<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Settings â€“ Invoicely</title>
    <link href="css/app.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        .disabled-input {
            background: #e6e6e6;
            pointer-events: none;
        }
    </style>
</head>

<body>

<div class="wrapper">

    <!-- Sidebar (unchanged) -->
    <nav id="sidebar" class="sidebar js-sidebar">
        <div class="sidebar-content js-simplebar">
            <a class="sidebar-brand" href="index.html">
                <span class="align-middle">INVOICELY</span>
            </a>

            <ul class="sidebar-nav">
                <li class="sidebar-item"><a class="sidebar-link" href="index.html">Dashboard</a></li>
                <li class="sidebar-item"><a class="sidebar-link" href="Sales_invoices_List.html">Sales Invoice List</a></li>
                <li class="sidebar-item"><a class="sidebar-link" href="Purchase_invoices_List.html">Purchase Invoice List</a></li>
                <li class="sidebar-item"><a class="sidebar-link" href="Purchase-Invoice.html">Create Purchase Invoice</a></li>
                <li class="sidebar-item"><a class="sidebar-link" href="Sales-Invoice.html">Create Sales Invoice</a></li>
                <li class="sidebar-item active"><a class="sidebar-link" href="settings.html">Settings</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main -->
    <div class="main">
        <main class="content">
            <div class="container-fluid p-0">

                <h1 class="h3 mb-3">Settings</h1>

                <div class="card">
                    <div class="card-body">

                        <h3 class="mb-4">Company Profile</h3>

                        <button id="editBtn" class="btn btn-secondary mb-3">Edit Profile</button>

                        <form id="profileForm">

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label>Company Name</label>
                                    <input type="text" id="companyName" class="form-control disabled-input">
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Owner Name</label>
                                    <input type="text" id="ownerName" class="form-control disabled-input">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label>Address</label>
                                <textarea id="address" class="form-control disabled-input"></textarea>
                            </div>

                            <div class="row">

                                <div class="col-md-6 mb-3">
                                    <label>Mobile Number</label>
                                    <input type="text" id="mobile" class="form-control disabled-input">
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>GSTIN</label>
                                    <input type="text" id="gstin" class="form-control disabled-input">
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Account Number</label>
                                    <input type="text" id="accountnumber" class="form-control disabled-input">
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label>Account Holder Name</label>
                                    <input type="text" id="accountholdername" class="form-control disabled-input">
                                </div>

                            </div>

                            <button type="submit" id="saveBtn" class="btn btn-primary w-100" disabled>Save Profile</button>

                        </form>

                    </div>
                </div>

            </div>
        </main>
    </div>

</div>

<!-- Axios Logic -->
<script>

let PROFILE_URL = "http://localhost:8080/api/companies";
let profileId = null;

function disableForm() {
    document.querySelectorAll(".form-control").forEach(f => {
        f.classList.add("disabled-input");
        f.disabled = true;
    });
    saveBtn.disabled = true;
}

function enableForm() {
    document.querySelectorAll(".form-control").forEach(f => {
        f.classList.remove("disabled-input");
        f.disabled = false;
    });
    saveBtn.disabled = false;
}

function loadProfile() {
    axios.get(PROFILE_URL)
        .then(res => {
            if (res.data.length > 0) {
                let p = res.data[0];
                profileId = p.id;

                companyName.value = p.companyName || "";
                ownerName.value = p.ownerName || "";
                address.value = p.address || "";
                mobile.value = p.mobile || "";
                gstin.value = p.gstin || "";
                accountnumber.value = p.accountnumber || "";
                accountholdername.value = p.accountholdername || "";
            }
        })
        .catch(err => console.log("GET ERROR:", err));
}

document.addEventListener("DOMContentLoaded", function () {
    loadProfile();
    disableForm();
});

editBtn.addEventListener("click", function () {
    enableForm();
});

profileForm.addEventListener("submit", function (e) {
    e.preventDefault();

    const data = {
        companyName: companyName.value,
        ownerName: ownerName.value,
        address: address.value,
        mobile: mobile.value,
        gstin: gstin.value,
        accountnumber: accountnumber.value,
        accountholdername: accountholdername.value
    };

    if (profileId) {
        axios.put(`${PROFILE_URL}/${profileId}`, data)
            .then(() => alert("Profile updated successfully!"))
            .catch(() => alert("Update Failed!"));
    } else {
        axios.post(PROFILE_URL, data)
            .then(res => {
                profileId = res.data.id;
                alert("Profile Saved Successfully!");
            })
            .catch(() => alert("Save Failed!"));
    }

});

</script>

</body>
</html>
